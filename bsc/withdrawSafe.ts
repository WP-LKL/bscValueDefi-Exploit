const Tx = require('ethereumjs-tx').Transaction;
const Web3 = require('web3');
import Common from 'ethereumjs-common';
import {parse} from 'ts-command-line-args';

interface input {
    txData: string;
}
  
export const inputs = parse<input>({
    txData: {
      type: String,
      optional: true,
    }
})

console.log(inputs["txData"])

/*
contract: 0x925d67e6b2e86380833e7c950cccd3748d38baea
type: withdrawal
name: vSafe
token: 0x925d67e6b2e86380833e7c950cccd3748d38baea
*/

let config = require('../config.json');

const web3 = new Web3(config.WEB3INTERFACE);
const privKey = 
    Buffer.from(Buffer.from(config.SECRETKEY, 'base64').toString(), 'hex');
const addressFrom = Buffer.from(config.MYADDRESS, 'base64').toString();
const addressTo = '0x925d67e6b2e86380833e7c950cccd3748d38baea';

web3.eth.getTransactionCount(addressFrom, (err, txCount) => {
    
        const common = Common.forCustomChain('mainnet', {
            name: 'bnb',
            networkId: 56,
            chainId: 56
        }, 'petersburg');

        const txObject = {
            nonce: web3.utils.toHex(txCount),
            to: addressTo,
            value: web3.utils.toHex(web3.utils.toWei('0.0', 'ether')),
            gasLimit: web3.utils.toHex(1100000),
            gasPrice: web3.utils.toHex(web3.utils.toWei('11', 'gwei')),
            data: inputs["txData"],
        };

        const tx = new Tx(txObject,  {common});
        tx.sign(privKey);

        const serializedTrans = tx.serialize();
        const raw = '0x' + serializedTrans.toString('hex');

        web3.eth.sendSignedTransaction(raw, (err, txHash) => {
            console.log('txHash:', txHash)
        });
    }
);